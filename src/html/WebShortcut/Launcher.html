<!DOCTYPE html>
<!-- The contact and back icons were downloaded from iconfinder.
     They are from the "Pictype Free Vector Icons" set created by Timothy Miller under
	 the Creative Commons (Attribution-Share Alike 3.0 Unported) license.
	 The URL is https://www.iconfinder.com/iconsets/pictype-free-vector-icons
-->

    <!-- http://filedropjs.org/demo/ 
	     http://www.sitepoint.com/html5-file-drag-and-drop/
		 http://blog.teamtreehouse.com/uploading-files-ajax
		 -->
 
<html>
  <head>
    <title>Web Shortcut Launcher</title>

	  <link rel="stylesheet" type="text/css" href="webshortcut.css">

	  <link rel="icon" type="image/png" href="favicon16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="favicon32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="favicon192.png" sizes="192x192">
    
    <style>
      #filedrag {
      	font-weight: bold;
	      text-align: center;
	      vertical-align: middle;
        line-height: 200px;
        width: 50%;
        height: 200px;
      }
      fieldset {
        border: 0;
      }
    </style>

	  <script src="jquery.js"></script>
	  <script src="webshortcut.js"></script>
	  <script src="server.js"></script>
  </head>

  <body>
  	<header>
  		<h1>Web Shortcut Tools</h1>
  		<nav>
  		  <h3>
  			<ul>
  			  <li><a href="index.html">Overview</a></li>
  				<li>Launcher</li>
  				<li><a href="Converter.html">Converter</a></li>
  			</ul>
  			</h3>
  		</nav>
  	</header>
  
  	<form id="upload" action="../cgi/parseshortcut.cgi" method="POST" enctype="multipart/form-data">
  		<fieldset>
    		<input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="100000" />
  
  			<label for="fileselect">Files to upload:</label>
  			<input type="file" id="fileselect" name="shortcuts[]" multiple="multiple" />
  
    	  <div id="submitbutton">
          <button type="submit">Upload Files</button>
        </div>
  		</fieldset>
  	</form>
  
  	<div id="filedrag">or drop files here</div>
  
  	<div id="messages"/>
  	
  	<script>
  		// output information
  		function Output(msg) {
  			var m = $("#messages")[0];
  			m.innerHTML = msg;
  		}
  		
  		// call initialization file
      if (window.File && window.FileList && window.FileReader) {
        Init();
      }
  		
  		function Init() {
  			var fileselect = $("#fileselect")[0],
  				filedrag = $("#filedrag")[0],
  				submitbutton = $("#submitbutton")[0];
  
  			fileselect.addEventListener("change", FileSelectHandler, false);
  
  			// If XMLHttpRequest is available, enable the event listeners and hide the submit button?
  			var xhr = new XMLHttpRequest();
  			if (xhr.upload) {	
  				filedrag.addEventListener("dragover", FileDragHover, false);
  				filedrag.addEventListener("dragleave", FileDragHover, false);
  				filedrag.addEventListener("drop", FileSelectHandler, false);
  				filedrag.style.display = "block";
  				
  				submitbutton.style.display = "none";
  			}
  
  		}
  		
  		// file drag hover
  		function FileDragHover(e) {
  			e.stopPropagation();
  			e.preventDefault();
  			e.target.className = (e.type == "dragover" ? "hover" : "");
  		}
  		
  		// file selection
  		function FileSelectHandler(e) {
  
  			// cancel event and hover styling
  			FileDragHover(e);

        ProcessDraggedShortcutFiles(
          e,
          processResponse,
          function(data) {
            alert('An error occurred!');
          }
        );
      }
  
  		function htmlEncode(value) {
  		    return $('<div/>').text(value).html();
  		}
  
  		function processResponse(response) {
        var tablebody = ""
        
        $(response).find("shortcut").each(function() {
          var shortcut = $(this);
        
  				tablebody = tablebody + "<tr>";
  				var filename = shortcut.find("filename");
  				tablebody = tablebody + "<td>" + htmlEncode(filename.text()) + "</td>";
  				var errormsg = shortcut.find("error");
  				if(errormsg.length) {
  					tablebody = tablebody + "<td>" + htmlEncode(errormsg.text()) + "</td>";
  				} else {
  					var urlElement = shortcut.find("url");
  					var url = urlElement.text();
  					tablebody = tablebody + "<td><a href=\"" + htmlEncode(url) + "\">" + htmlEncode(url) + "</a></td>";
  					window.open(url);
  				}
  				tablebody = tablebody + "</tr>";
  			});
  
        Output(
          "<h3>Results:</h3><table border=\"1\">" +
          "<thead><tr><th>File Name</th><th>Result</th></tr></thead>" +
          "<tbody>" +
          tablebody +
          "</tbody>" +
          "</table>");
  		}

  	</script>

  </body>

</html> 
